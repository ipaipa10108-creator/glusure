# Glusure - ä½ çš„å€‹äººå¥åº·è¿½è¹¤åŠ©æ‰‹

Glusure æ˜¯ä¸€å€‹å°ˆæ³¨æ–¼è¡€ç³–èˆ‡å¥åº·æ•¸æ“šè¿½è¹¤çš„æ‡‰ç”¨ç¨‹å¼ï¼Œæ—¨åœ¨å¹«åŠ©ä½¿ç”¨è€…ç´€éŒ„æ¯æ—¥å¥åº·ç‹€æ³ï¼Œä¸¦æä¾›è¦–è¦ºåŒ–çš„æ•¸æ“šåˆ†æèˆ‡é†«å¸«å‹å–„çš„æª¢è¦–æ¨¡å¼ã€‚

## âœ¨ ä¸»è¦åŠŸèƒ½

-   **ä½¿ç”¨è€…éš”é›¢èˆ‡ç§éš±**ï¼šç³»çµ±ä»¥ä½¿ç”¨è€…åç¨±ç‚º Key å€éš”è³‡æ–™ï¼Œä½¿ç”¨è€…åƒ…èƒ½ç€è¦½èˆ‡ç®¡è½„è‡ªå·±çš„å¥åº·ç´€éŒ„ï¼Œç¢ºä¿è³‡æ–™ç§éš±ã€‚
-   **å…¨æ–¹ä½å¥åº·ç´€éŒ„**ï¼šæ”¯æ´é«”é‡ã€è¡€å£“ï¼ˆæ”¶ç¸®å£“/èˆ’å¼µå£“ï¼‰ã€å¿ƒç‡åŠå„æ™‚æ®µè¡€ç³–ï¼ˆç©ºè…¹/é£¯å¾Œ/éš¨æ©Ÿï¼‰ç´€éŒ„ã€‚
-   **å¿ƒè·³è¿½è¹¤èˆ‡è­¦ç¤º**ï¼šè¡€å£“åœ–è¡¨æ•´åˆå¿ƒè·³è¶¨å‹¢ï¼Œé†«å¸«æ¨¡å¼ä¸­è‹¥åµæ¸¬åˆ°ç•°å¸¸å¿ƒè·³ï¼ˆ>90 æˆ– <60 bpmï¼‰æœƒè‡ªå‹•ä»¥ç´…è‰²æ¨™ç¤ºè­¦ç¤ºã€‚
-   **æ™ºæ…§è³‡æ–™åˆä½µ**ï¼šåŒä¸€å¤©çš„å¤šç­†ç´€éŒ„æœƒè‡ªå‹•åˆä½µï¼Œä¸¦ä¿ç•™å®Œæ•´çš„è¡€ç³–æ¸¬é‡ç´°ç¯€ã€‚
-   **è¦–è¦ºåŒ–å„€è¡¨æ¿**ï¼šæä¾›ç›´è§€çš„åœ–è¡¨åˆ†æï¼Œå”åŠ©æ‚¨æŒæ¡å¥åº·è¶¨å‹¢ã€‚
-   **é€²éšé†«å¸«æª¢è¦–æ¨¡å¼**ï¼š
    -   å°ˆç‚ºé†«ç™‚è«®è©¢è¨­è¨ˆçš„æ¯æ—¥å½™æ•´åˆ—è¡¨ã€‚
    -   **è‡ªå‹•æ’åº**ï¼šé è¨­ç”±èˆŠåˆ°æ–°æ’åºï¼Œæ–¹ä¾¿é†«å¸«æŒ‰æ™‚é–“è»¸æŸ¥çœ‹ç—…æƒ…æ¼”é€²ã€‚
    -   **ä»‹é¢å„ªåŒ–**ï¼šé‡å°æ‰‹æ©Ÿç‰ˆé¢é€²è¡Œå„ªåŒ–ï¼Œç·Šæ¹Šå‘ˆç¾ã€Œæ—¥æœŸã€è¡€å£“ã€è¡€ç³–ã€é«”é‡ã€å››å¤§æ ¸å¿ƒæ•¸æ“šã€‚
    -   **é€±æœ«æ¨™è¨˜**ï¼šé€±å…­ã€é€±æ—¥ç´€éŒ„ä»¥æ©˜è‰²èƒŒæ™¯çªé¡¯ï¼Œæ–¹ä¾¿è¾¨è­˜ç”Ÿæ´»ä½œæ¯å·®ç•°å°æ•¸å€¼çš„å½±éŸ¿ã€‚
-   **è³‡æ–™å®‰å…¨**ï¼šæ”¯æ´ Google Sheets ä½œç‚ºå¾Œç«¯è³‡æ–™åº«ï¼Œæ•¸æ“šå®Œå…¨æŒæ¡åœ¨æ‚¨æ‰‹ä¸­ã€‚

## ğŸ§ª æ¸¬è©¦å¸³è™Ÿ

å¦‚æœæ‚¨æƒ³å¿«é€Ÿäº†è§£ç³»çµ±å‘ˆç¾æ¨£è²Œï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å¸³è™Ÿç™»å…¥ï¼š
-   **åç¨±**ï¼š`TestUser123`
-   **ç‰¹æ€§**ï¼šç™»å…¥å¾Œè‹¥ç„¡è³‡æ–™ï¼Œç³»çµ±æœƒè‡ªå‹•ç”¢ç”Ÿ**éå»ä¸‰å€‹æœˆ**çš„æ¨¡æ“¬å¥åº·æ•¸æ“šï¼ˆåŒ…å«è¡€ç³–è®ŠåŒ–ã€è¡€å£“å¿ƒè·³èˆ‡é«”é‡è¶¨å‹¢ï¼‰ï¼Œè®“æ‚¨å³åˆ»é«”é©—å®Œæ•´çš„å„€è¡¨æ¿èˆ‡é†«å¸«æ¨¡å¼åŠŸèƒ½ã€‚

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. å»ºç«‹ Google Sheets è³‡æ–™åº«

æœ¬å°ˆæ¡ˆä½¿ç”¨ Google Sheets èˆ‡ Google Apps Script (GAS) ä½œç‚ºå¾Œç«¯ APIã€‚è«‹åœ¨æ‚¨çš„è©¦ç®—è¡¨ä¸­å»ºç«‹å…©å€‹å·¥ä½œè¡¨ï¼š

#### **å·¥ä½œè¡¨ 1ï¼š`HealthRecords`**

| æ¬„ä½åç¨± (Header) | èªªæ˜ |
| :--- | :--- |
| `id` | å”¯ä¸€è­˜åˆ¥ç¢¼ |
| `timestamp` | ISO 8601 æ™‚é–“æˆ³è¨˜ |
| `name` | ä½¿ç”¨è€…åç¨± |
| `weight` | é«”é‡ (kg) |
| `systolic` | æ”¶ç¸®å£“ (mmHg) |
| `diastolic` | èˆ’å¼µå£“ (mmHg) |
| `heart_rate` | å¿ƒç‡ (bpm) |
| `glucose_fasting` | ç©ºè…¹è¡€ç³– |
| `glucose_post_meal` | é£¯å¾Œè¡€ç³– |
| `glucose_random` | éš¨æ©Ÿè¡€ç³– |
| `note` | å‚™è¨» |
| `details_json` | è©³ç´°è¡€ç³–ç´€éŒ„ (JSON) |
| `updated_at` | æœ€å¾Œæ›´æ–°æ™‚é–“ |

#### **å·¥ä½œè¡¨ 2ï¼š`UserSettings`**

| æ¬„ä½åç¨± (Header) | èªªæ˜ |
| :--- | :--- |
| `name` | ä½¿ç”¨è€…åç¨± (å”¯ä¸€è­˜åˆ¥) |
| `password` | ç™»å…¥å¯†ç¢¼ (é è¨­å»ºè­° 1234) |
| `thresholds` | JSON æ ¼å¼çš„è­¦ç¤ºé–¾å€¼è¨­å®š |
| `updated_at` | æœ€å¾Œæ›´æ–°æ™‚é–“ |

### 2. è¨­å®š Google Apps Script (GAS)

1. åœ¨è©¦ç®—è¡¨ä¸­é»é¸ `æ“´å……åŠŸèƒ½` > `Apps Script`ã€‚
2. è¤‡è£½ä»¥ä¸‹ç¨‹å¼ç¢¼ï¼ˆè™•ç†ç™»å…¥ã€ç´€éŒ„å„²å­˜èˆ‡è¨­å®šæ›´æ–°ï¼‰ï¼š

```javascript
const RECORDS_SHEET = 'HealthRecords';
const SETTINGS_SHEET = 'UserSettings';

function doPost(e) {
  return handleResponse(() => {
    const params = JSON.parse(e.postData.contents);
    const action = params.action;
    const ss = SpreadsheetApp.getActiveSpreadsheet();
    
    // --- ä½¿ç”¨è€…ç™»å…¥ (Login) ---
    if (action === 'login') {
      const sheet = ss.getSheetByName(SETTINGS_SHEET);
      const data = sheet.getDataRange().getValues();
      const name = params.name;
      const password = String(params.password || "1234");
      
      for (let i = 1; i < data.length; i++) {
        if (data[i][0] === name) {
          if (String(data[i][1]) === password) {
            return { status: 'success', settings: { name: name, thresholds: data[i][2] } };
          } else {
            throw new Error('å¯†ç¢¼éŒ¯èª¤');
          }
        }
      }
      // è‹¥æ‰¾ä¸åˆ°ä½¿ç”¨è€…ï¼Œè‡ªå‹•å»ºç«‹é è¨­å¸³è™Ÿ
      sheet.appendRow([name, "1234", "", new Date()]);
      return { status: 'success', settings: { name: name, thresholds: "" } };
    }

    // --- æ›´æ–°å€‹äººè¨­å®š (Update Settings) ---
    if (action === 'updateSettings') {
      const sheet = ss.getSheetByName(SETTINGS_SHEET);
      const data = sheet.getDataRange().getValues();
      const settings = params.settings;
      
      for (let i = 1; i < data.length; i++) {
        if (data[i][0] === settings.name) {
          sheet.getRange(i + 1, 2).setValue(settings.password);
          sheet.getRange(i + 1, 3).setValue(settings.thresholds);
          sheet.getRange(i + 1, 4).setValue(new Date());
          return { status: 'success' };
        }
      }
      return { status: 'error', message: 'User not found' };
    }

    // --- åˆªé™¤ç´€éŒ„ (Delete) ---
    if (action === 'delete') {
      const sheet = ss.getSheetByName(RECORDS_SHEET);
      const idToDelete = params.id;
      const data = sheet.getDataRange().getValues();
      for (let i = 1; i < data.length; i++) {
        if (data[i][0] == idToDelete) {
          sheet.deleteRow(i + 1);
          return { status: 'success' };
        }
      }
      return { status: 'error', message: 'Record not found' };
    }

    // --- å„²å­˜æˆ–æ›´æ–°ç´€éŒ„ (Save Record) ---
    const sheet = ss.getSheetByName(RECORDS_SHEET);
    const record = params.record;
    const headers = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
    const data = sheet.getDataRange().getValues();
    let rowIndex = -1;
    
    if (record.id) {
      for (let i = 1; i < data.length; i++) {
        if (data[i][0] == record.id) { rowIndex = i + 1; break; }
      }
    }

    const rowData = headers.map(header => {
      switch(header) {
        case 'id': return record.id || Utilities.getUuid();
        case 'updated_at': return new Date();
        case 'details_json': return record.details || '';
        case 'heart_rate': return record.heartRate;
        case 'glucose_fasting': return record.glucoseFasting;
        case 'glucose_post_meal': return record.glucosePostMeal;
        case 'glucose_random': return record.glucoseRandom;
        default: return record[header] || '';
      }
    });

    if (rowIndex > 0) {
      sheet.getRange(rowIndex, 1, 1, rowData.length).setValues([rowData]);
    } else {
      sheet.appendRow(rowData);
    }
    return { status: 'success' };
  });
}

function doGet(e) {
  return handleResponse(() => {
    const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(RECORDS_SHEET);
    const data = sheet.getDataRange().getValues();
    const headers = data[0];
    const rows = data.slice(1);
    return rows.map(row => {
      const record = {};
      headers.forEach((h, i) => record[h === 'details_json' ? 'details' : h] = row[i]);
      return record;
    });
  });
}

function handleResponse(callback) {
  try {
    const result = callback();
    return ContentService.createTextOutput(JSON.stringify(result)).setMimeType(ContentService.MimeType.JSON);
  } catch (e) {
    return ContentService.createTextOutput(JSON.stringify({ status: 'error', message: e.toString() })).setMimeType(ContentService.MimeType.JSON);
  }
}
```

3. é»é¸ `éƒ¨ç½²` > `æ–°å¢éƒ¨ç½²` > é¡å‹é¸æ“‡ `ç¶²é æ‡‰ç”¨ç¨‹å¼`ã€‚
4. å­˜å–æ¬Šé™è¨­å®šç‚º `ä»»ä½•äºº (Any one)`ï¼ˆ**æ³¨æ„ï¼šé€™æ˜¯ç‚ºäº†è®“ App èƒ½è·¨ç¶²åŸŸå­˜å–ï¼Œè«‹ç¢ºä¿æ‚¨çš„ API URL ä¸å¤–æµ**ï¼‰ã€‚
5. è¤‡è£½å–å¾—çš„ **Web App URL**ã€‚

### 3. ç’°å¢ƒè®Šæ•¸è¨­å®š

è¤‡è£½ `.env.example` ç‚º `.env` (æœ¬åœ°é–‹ç™¼ç”¨) æˆ–åœ¨ GitHub Secrets è¨­å®š (éƒ¨ç½²ç”¨)ï¼š

```bash
VITE_API_URL=https://script.google.com/macros/s/æ‚¨çš„SCRIPT_ID/exec
```

### 4. æœ¬åœ°é–‹ç™¼

```bash
# å®‰è£ç›¸ä¾å¥—ä»¶
npm install

# å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
npm run dev
```

## ğŸ“¦ è‡ªå‹•éƒ¨ç½² (GitHub Pages)

æœ¬å°ˆæ¡ˆå·²è¨­å®š GitHub Actionsï¼Œç•¶æ‚¨ Push ç¨‹å¼ç¢¼åˆ° `main` åˆ†æ”¯æ™‚ï¼Œæœƒè‡ªå‹•å»ºç½®ä¸¦éƒ¨ç½²è‡³ GitHub Pagesã€‚

**è¨­å®šæ­¥é©Ÿï¼š**

1. å°‡ç¨‹å¼ç¢¼ Push åˆ° GitHub Repositoryã€‚
2. åœ¨ GitHub Repo é é¢ï¼Œé€²å…¥ `Settings` > `Pages`ï¼Œç¢ºèª Source è¨­å®šç‚º `GitHub Actions`ã€‚
3. é€²å…¥ `Settings` > `Secrets and variables` > `Actions`ã€‚
4. é»é¸ `New repository secret`ï¼Œæ–°å¢ï¼š
    - Name: `VITE_API_URL`
    - Value: `æ‚¨çš„ Google Apps Script Web App URL`
5. ä¸‹æ¬¡ Push `main` åˆ†æ”¯æ™‚ï¼ŒActions å°‡æœƒè‡ªå‹•åŸ·è¡Œä¸¦éƒ¨ç½²ã€‚
